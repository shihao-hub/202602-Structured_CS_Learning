# 计算机组成原理 (Computer Architecture)

本目录包含了计算机组成原理核心概念的Go语言实现，帮助你深入理解计算机硬件系统的工作原理。

## 目录结构

### [CPU设计](./cpu/)
- **寄存器(Registers)** - 通用寄存器、特殊寄存器
- **ALU(算术逻辑单元)** - 算术运算、逻辑运算
- **控制单元(Control Unit)** - 指令译码、控制信号生成
- **CPU周期(CPU Cycles)** - 取指、译码、执行周期
- **微程序控制(Microprogramming)** - 微指令、微操作

### [存储器层次结构](./memory/)
- **高速缓存(Cache)** - L1/L2/L3缓存、映射策略
- **主存储器(Main Memory)** - RAM、ROM、存储组织
- **虚拟存储器(Virtual Memory)** - 页表、TLB
- **存储器映射(Memory Mapping)** - 地址映射、地址转换
- **存储器层次(Memory Hierarchy)** - 层次结构、性能优化

### [总线系统](./bus/)
- **系统总线(System Bus)** - 地址总线、数据总线、控制总线
- **总线协议(Bus Protocol)** - 总线仲裁、总线时序
- **总线标准(Bus Standards)** - PCI、USB、ISA
- **DMA控制器(DMA Controller)** - 直接内存访问
- **中断系统(Interrupt System)** - 中断处理、中断优先级

### [指令系统](./instruction_set/)
- **指令格式(Instruction Format)** - 操作码、地址码
- **寻址方式(Addressing Modes)** - 立即寻址、直接寻址、间接寻址
- **指令类型(Instruction Types)** - 数据传输、算术逻辑、控制转移
- **RISC vs CISC** - 精简指令集、复杂指令集对比
- **汇编语言基础(Assembly Basics)** - 基本语法、伪指令

### [流水线技术](./pipeline/)
- **指令流水线(Instruction Pipeline)** - 流水线阶段、流水线冒险
- **流水线冲突(Pipeline Hazards)** - 结构冒险、数据冒险、控制冒险
- **流水线优化(Pipeline Optimization)** - 分支预测、转发技术
- **超标量处理(Superscalar)** - 多指令发射
- **乱序执行(Out-of-Order Execution)** - 动态调度

## 核心概念

### 计算机组成层次
1. **数字逻辑层** - 逻辑门、触发器、寄存器
2. **微程序层** - 微指令、微操作序列
3. **指令系统层** - 机器指令、指令系统
4. **操作系统层** - 系统调用、进程管理
5. **汇编语言层** - 汇编程序、汇编器
6. **高级语言层** - 编译器、解释器

### CPU性能指标
| 指标 | 定义 | 计算公式 |
|------|------|----------|
| 时钟频率 | CPU主时钟频率 | f = 1/T |
| CPI | 每条指令平均时钟周期数 | CPI = 总时钟周期数 / 指令数 |
| IPC | 每时钟周期指令数 | IPC = 指令数 / 总时钟周期数 |
| MIPS | 每秒百万指令数 | MIPS = f(MHz) / CPI |
| 执行时间 | 程序执行总时间 | T = 指令数 × CPI × 时钟周期 |

### 存储器层次结构
```
CPU Registers (1-2ns)
      ↑
L1 Cache (1-10ns)
      ↑
L2 Cache (10-30ns)
      ↑
L3 Cache (30-100ns)
      ↑
Main Memory (100ns-1μs)
      ↑
Secondary Storage (10-100ms)
```

### 指令执行周期
1. **取指周期(Instruction Fetch)** - 从内存读取指令
2. **译码周期(Instruction Decode)** - 解析指令操作码
3. **执行周期(Execute)** - 执行指令操作
4. **访存周期(Memory Access)** - 读写内存数据
5. **写回周期(Write-back)** - 将结果写入寄存器

### 寻址方式
| 寻址方式 | 示例 | 优点 | 缺点 |
|----------|------|------|------|
| 立即寻址 | MOV R1, #100 | 无需访存 | 数值范围受限 |
| 直接寻址 | MOV R1, [1000] | 简单直接 | 地址空间有限 |
| 间接寻址 | MOV R1, [R2] | 灵活性高 | 需要额外访存 |
| 寄存器寻址 | MOV R1, R2 | 速度快 | 寄存器数量有限 |
| 寄存器间接 | MOV R1, [R2] | 灵活性好 | 需要额外寄存器 |

### 流水线阶段
1. **IF** - 指令取指(Instruction Fetch)
2. **ID** - 指令译码(Instruction Decode)
3. **EX** - 执行运算(Execute)
4. **MEM** - 存储器访问(Memory Access)
5. **WB** - 写回寄存器(Write Back)

## 性能优化技术

### 高速缓存优化
- **空间局部性** - 访问相邻的内存位置
- **时间局部性** - 重复访问相同位置
- **替换策略** - LRU、FIFO、随机替换
- **写策略** - 写直达、写回

### 分支预测
- **静态预测** - 总是预测不跳转
- **动态预测** - 基于历史预测
- **两级自适应预测** - 2-bit饱和计数器
- **分支目标缓冲** - 缓存分支目标地址

### 流水线优化
- **指令重排** - 避免数据冒险
- ** forwarding** - 前转技术解决数据冒险
- **分支延迟槽** - 在分支指令后填充有用指令
- **乱序执行** - 动态调度指令执行顺序

## 学习建议

1. **理解层次结构** - 从数字逻辑到系统软件的层次关系
2. **掌握性能分析** - 学会计算CPI、MIPS等性能指标
3. **实践动手** - 通过编程实现CPU、内存、总线的模拟
4. **对比分析** - 比较不同架构和优化技术的优缺点
5. **联系实际** - 了解现代处理器的实际实现

## 实验环境

- Go 1.21+
- 推荐 IDE: VS Code / GoLand
- 调试工具: Delve debugger
- 性能分析工具: pprof